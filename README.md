# autosave
NS用のオートセーブスクリプト（nettool必須）

## 注意
- このスクリプトは単体では動きません
    - nettool(公式がソース公開　ビルド必須)
    - startscript(自家製：https://github.com/KU-TANS/startscript)
        - pak.pakname_server.exe(Windowsのみ)
        - pak128japan_server.ps1(Linuxのみ)
        - version
        - version_server
- 以下を参考にしながら本体と同様のディレクトリに配置してください

## 仕様
- サーバー専用
- nettool必要
- versionやversion_serverの情報を元に動きます
- autosaveやsimutransが落ちた時に再起動します
- pakの名前が違う場合にはスクリプト名を書き換えてください
    - 例：autosave_pak.nippon.ps1
- スクリプト内にオートセーブの間隔を書くことが書くことができます
    - 最低間隔は3分です
    - オートセーブのタイミングにsimutransが起動していなければ再起動します
    - スクリプト起動時にsimutransが起動していなければ起動します
- セーブ間隔は最後に書かれたセーブを元にします
    - 例：30分間隔の場合、オートセーブの20分後にアクセスがありセーブが書かれたとする
        - オートセーブのタイミングではセーブを書かれない
        - 最新のセーブデータをバックアップする
        - そのセーブデータから30分後、（この状況ではバックアップから20分後）にオートセーブが行われる
- 1つ前のオートセーブもしくはバックアップまでプレイヤーがアクセスしており、今のオートセーブもしくはバックアップのタイミングにプレイヤーが誰もいなければセーブした後に本体を再起動します
    - simutransの長時間起動で重くなるのを防ぐため
- その他タイミングでプレイヤーがいない場合はセーブしません
- このスクリプトを終了すると本体まで終了してしまうので注意してください
- autosave_windows.ps1
    - バックアップ方式がgitになっています
        - gitが使える環境で動作させてください
        - スクリプト内にバックアップを配置するgitフォルダを入力してください
    - pak.pakname_server.exeのpak.paknameの部分をpakフォルダ名にリネームしたものが必要です
- autosave_linux.ps1
    - セーブファイルは./save/にバックアップされます
        - 貯まっていく一方なので適宜手動で消してください
    - このスクリプトを終了するとsimutrans本体まで終了してしまうので注意してください
    - pak128japan_server.ps1のpak128japanの部分をpakフォルダ名にリネームしたものが必要です

##### バックアップ方式の違いは弊NSの都合上です。適宜書き換えてください